<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daftar Akun - WeatherID</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
  </head>
  <body class="bg-gradient d-flex flex-column min-vh-100">
    <main class="container py-4 flex-grow-1 d-flex align-items-center justify-content-center">
      <div class="auth-container bg-blur p-4 rounded-4 shadow animate__animated animate__fadeIn" style="max-width: 500px; width: 100%;">
        <div class="text-center mb-4">
          <h2><i class="bi bi-person-plus me-2"></i>Daftar Akun Baru</h2>
          <p class="text-light-teal">Bergabunglah untuk mulai menggunakan WeatherID</p>
        </div>

        {% with messages=get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <form method="POST" action="{{ url_for('register') }}" class="needs-validation" novalidate>
          <div class="mb-3">
            <label for="username" class="form-label">Username*</label>
            <div class="input-group">
              <span class="input-group-text bg-teal text-white"><i class="bi bi-person"></i></span>
              <input type="text" class="form-control bg-white-translucent" id="username" name="username" required />
            </div>
            <small class="text-light-teal">Harus unik, akan digunakan untuk login</small>
          </div>

          <div class="mb-3">
            <label for="nickname" class="form-label">Nama Panggilan*</label>
            <div class="input-group">
              <span class="input-group-text bg-teal text-white"><i class="bi bi-chat-square-text"></i></span>
              <input type="text" class="form-control bg-white-translucent" id="nickname" name="nickname" required />
            </div>
            <small class="text-light-teal">Nama yang akan ditampilkan di aplikasi</small>
          </div>

          <div class="mb-3">
            <label for="password" class="form-label">Password*</label>
            <div class="input-group">
              <span class="input-group-text bg-teal text-white"><i class="bi bi-lock"></i></span>
              <input type="password" class="form-control bg-white-translucent" id="password" name="password" required minlength="8" />
              <button class="btn btn-outline-light" type="button" id="togglePassword"><i class="bi bi-eye"></i></button>
            </div>
            <small class="text-light-teal">Minimal 8 karakter</small>
          </div>

          <div class="mb-3">
            <label for="password_confirm" class="form-label">Konfirmasi Password*</label>
            <div class="input-group">
              <span class="input-group-text bg-teal text-white"><i class="bi bi-lock-fill"></i></span>
              <input type="password" class="form-control bg-white-translucent" id="password_confirm" name="password_confirm" required minlength="8" />
              <button class="btn btn-outline-light" type="button" id="togglePasswordConfirm"><i class="bi bi-eye"></i></button>
            </div>
          </div>

          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <div class="input-group">
              <span class="input-group-text bg-teal text-white"><i class="bi bi-envelope"></i></span>
              <input type="email" class="form-control bg-white-translucent" id="email" name="email" />
            </div>
          </div>

          <div class="d-grid gap-2 mt-4">
            <button type="submit" class="btn btn-teal btn-lg"><i class="bi bi-person-plus me-2"></i>Daftar</button>
          </div>

          <div class="mt-3 text-center">
            <p>
              Sudah punya akun? <a href="{{ url_for('login') }}" class="text-light-teal fw-bold">Login disini</a>
            </p>
          </div>
        </form>
      </div>
    </main>

    {% include 'components/footer.html' %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Toggle password visibility
      const togglePassword = document.querySelector('#togglePassword')
      const togglePasswordConfirm = document.querySelector('#togglePasswordConfirm')
      
      if (togglePassword) {
        togglePassword.addEventListener('click', function () {
          const password = document.querySelector('#password')
          const type = password.getAttribute('type') === 'password' ? 'text' : 'password'
          password.setAttribute('type', type)
          this.querySelector('i').classList.toggle('bi-eye-slash')
        })
      }
      
      if (togglePasswordConfirm) {
        togglePasswordConfirm.addEventListener('click', function () {
          const passwordConfirm = document.querySelector('#password_confirm')
          const type = passwordConfirm.getAttribute('type') === 'password' ? 'text' : 'password'
          passwordConfirm.setAttribute('type', type)
          this.querySelector('i').classList.toggle('bi-eye-slash')
        })
      }
      
      // Form validation
      document.querySelector('form').addEventListener('submit', function (e) {
        const password = document.getElementById('password').value
        const passwordConfirm = document.getElementById('password_confirm').value
      
        if (password !== passwordConfirm) {
          e.preventDefault()
          alert('Konfirmasi password tidak sesuai!')
          return false
        }
      
        if (password.length < 8) {
          e.preventDefault()
          alert('Password minimal 8 karakter!')
          return false
        }
      })
    </script>
  </body>
</html>
